```python
import pandas as pd
import plotly.express as px
import numpy as np
from plotly.offline import iplot, init_notebook_mode
init_notebook_mode(connected=True)
```


<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax) {MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.9.0.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>




```python
url = "https://raw.githubusercontent.com/bcaffo/MRIcloudT1volumetrics/master/inst/extdata/multilevel_lookup_table.txt"
multilevel_lookup = pd.read_csv(url, sep = "\t").drop(['Level5'], axis = 1)
multilevel_lookup = multilevel_lookup.rename(columns = {
    "modify"   : "roi", 
    "modify.1" : "level4",
    "modify.2" : "level3", 
    "modify.3" : "level2",
    "modify.4" : "level1"})
multilevel_lookup = multilevel_lookup[['roi', 'level4', 'level3', 'level2', 'level1']]
multilevel_lookup['level2'] = multilevel_lookup['level2'].str.strip()
multilevel_lookup.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>roi</th>
      <th>level4</th>
      <th>level3</th>
      <th>level2</th>
      <th>level1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SFG_L</td>
      <td>SFG_L</td>
      <td>Frontal_L</td>
      <td>CerebralCortex_L</td>
      <td>Telencephalon_L</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SFG_R</td>
      <td>SFG_R</td>
      <td>Frontal_R</td>
      <td>CerebralCortex_R</td>
      <td>Telencephalon_R</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SFG_PFC_L</td>
      <td>SFG_L</td>
      <td>Frontal_L</td>
      <td>CerebralCortex_L</td>
      <td>Telencephalon_L</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SFG_PFC_R</td>
      <td>SFG_R</td>
      <td>Frontal_R</td>
      <td>CerebralCortex_R</td>
      <td>Telencephalon_R</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SFG_pole_L</td>
      <td>SFG_L</td>
      <td>Frontal_L</td>
      <td>CerebralCortex_L</td>
      <td>Telencephalon_L</td>
    </tr>
  </tbody>
</table>
</div>




```python
id = 127
df = pd.read_csv("https://raw.githubusercontent.com/smart-stats/ds4bio_book/main/book/assetts/kirby21AllLevels.csv")
df = df.loc[(df.type == 1) & (df.level == 5) & (df.id == id)]
df = df[['roi', 'volume']]
df = pd.merge(df, multilevel_lookup, on = "roi")
df = df.assign(level0 = "ICV")
df = df.assign(comp = df.volume / np.sum(df.volume))
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>roi</th>
      <th>volume</th>
      <th>level4</th>
      <th>level3</th>
      <th>level2</th>
      <th>level1</th>
      <th>level0</th>
      <th>comp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SFG_L</td>
      <td>12926</td>
      <td>SFG_L</td>
      <td>Frontal_L</td>
      <td>CerebralCortex_L</td>
      <td>Telencephalon_L</td>
      <td>ICV</td>
      <td>0.009350</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SFG_R</td>
      <td>10050</td>
      <td>SFG_R</td>
      <td>Frontal_R</td>
      <td>CerebralCortex_R</td>
      <td>Telencephalon_R</td>
      <td>ICV</td>
      <td>0.007270</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SFG_PFC_L</td>
      <td>12783</td>
      <td>SFG_L</td>
      <td>Frontal_L</td>
      <td>CerebralCortex_L</td>
      <td>Telencephalon_L</td>
      <td>ICV</td>
      <td>0.009247</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SFG_PFC_R</td>
      <td>11507</td>
      <td>SFG_R</td>
      <td>Frontal_R</td>
      <td>CerebralCortex_R</td>
      <td>Telencephalon_R</td>
      <td>ICV</td>
      <td>0.008324</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SFG_pole_L</td>
      <td>3078</td>
      <td>SFG_L</td>
      <td>Frontal_L</td>
      <td>CerebralCortex_L</td>
      <td>Telencephalon_L</td>
      <td>ICV</td>
      <td>0.002227</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>275</th>
      <td>Chroid_LVetc_L</td>
      <td>444</td>
      <td>AnteriorLateralVentricle_L</td>
      <td>LateralVentricle_L</td>
      <td>Ventricle</td>
      <td>CSF</td>
      <td>ICV</td>
      <td>0.000321</td>
    </tr>
    <tr>
      <th>276</th>
      <td>Chroid_LVetc_R</td>
      <td>371</td>
      <td>AnteriorLateralVentricle_R</td>
      <td>LateralVentricle_R</td>
      <td>Ventricle</td>
      <td>CSF</td>
      <td>ICV</td>
      <td>0.000268</td>
    </tr>
    <tr>
      <th>277</th>
      <td>IV_ventricle</td>
      <td>2700</td>
      <td>IV_ventricle</td>
      <td>IV_ventricle</td>
      <td>Ventricle</td>
      <td>CSF</td>
      <td>ICV</td>
      <td>0.001953</td>
    </tr>
    <tr>
      <th>278</th>
      <td>ECCL_L</td>
      <td>292</td>
      <td>inf_DPWM_L</td>
      <td>InferiorWM_L</td>
      <td>WhiteMatter_L</td>
      <td>Telencephalon_L</td>
      <td>ICV</td>
      <td>0.000211</td>
    </tr>
    <tr>
      <th>279</th>
      <td>ECCL_R</td>
      <td>292</td>
      <td>inf_DPWM_R</td>
      <td>InferiorWM_R</td>
      <td>WhiteMatter_R</td>
      <td>Telencephalon_R</td>
      <td>ICV</td>
      <td>0.000211</td>
    </tr>
  </tbody>
</table>
<p>280 rows × 8 columns</p>
</div>




```python
import plotly.graph_objects as go
```


```python
l1 = df.groupby(['level1', 'level0']).sum().reset_index()
l1=l1.rename(columns = {'level1': 'target', 'level0' : 'source'}).drop(['volume'], axis =1)
l1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>source</th>
      <th>comp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CSF</td>
      <td>ICV</td>
      <td>0.079417</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Diencephalon_L</td>
      <td>ICV</td>
      <td>0.008548</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Diencephalon_R</td>
      <td>ICV</td>
      <td>0.008362</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Mesencephalon</td>
      <td>ICV</td>
      <td>0.007430</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Metencephalon</td>
      <td>ICV</td>
      <td>0.115313</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Myelencephalon</td>
      <td>ICV</td>
      <td>0.003599</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Telencephalon_L</td>
      <td>ICV</td>
      <td>0.384220</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Telencephalon_R</td>
      <td>ICV</td>
      <td>0.393111</td>
    </tr>
  </tbody>
</table>
</div>




```python
l2 = df.groupby(['level2', 'level1']).sum().reset_index()
l2=l2.rename(columns = {'level2': 'target', 'level1' : 'source'}).drop(['volume'], axis =1)
l2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>source</th>
      <th>comp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>BasalForebrain_L</td>
      <td>Diencephalon_L</td>
      <td>0.003960</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BasalForebrain_R</td>
      <td>Diencephalon_R</td>
      <td>0.003753</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CerebralCortex_L</td>
      <td>Telencephalon_L</td>
      <td>0.200361</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CerebralCortex_R</td>
      <td>Telencephalon_R</td>
      <td>0.204623</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CerebralNucli_L</td>
      <td>Telencephalon_L</td>
      <td>0.008956</td>
    </tr>
    <tr>
      <th>5</th>
      <td>CerebralNucli_R</td>
      <td>Telencephalon_R</td>
      <td>0.009460</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Mesencephalon_L</td>
      <td>Mesencephalon</td>
      <td>0.003577</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Mesencephalon_R</td>
      <td>Mesencephalon</td>
      <td>0.003853</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Metencephalon_L</td>
      <td>Metencephalon</td>
      <td>0.057506</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Metencephalon_R</td>
      <td>Metencephalon</td>
      <td>0.057807</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Myelencephalon_L</td>
      <td>Myelencephalon</td>
      <td>0.001738</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Myelencephalon_R</td>
      <td>Myelencephalon</td>
      <td>0.001861</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Sulcus_L</td>
      <td>CSF</td>
      <td>0.024577</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Sulcus_R</td>
      <td>CSF</td>
      <td>0.021714</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Thalamus_L</td>
      <td>Diencephalon_L</td>
      <td>0.004588</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Thalamus_R</td>
      <td>Diencephalon_R</td>
      <td>0.004609</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Ventricle</td>
      <td>CSF</td>
      <td>0.033126</td>
    </tr>
    <tr>
      <th>17</th>
      <td>WhiteMatter_L</td>
      <td>Telencephalon_L</td>
      <td>0.174904</td>
    </tr>
    <tr>
      <th>18</th>
      <td>WhiteMatter_R</td>
      <td>Telencephalon_R</td>
      <td>0.179029</td>
    </tr>
  </tbody>
</table>
</div>




```python
l3 = df.groupby(['level3', 'level2']).sum().reset_index()
l3=l3.rename(columns = {'level3': 'target', 'level2' : 'source'}).drop(['volume'], axis =1)
l3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>source</th>
      <th>comp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AnteriorWM_L</td>
      <td>WhiteMatter_L</td>
      <td>0.062947</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AnteriorWM_R</td>
      <td>WhiteMatter_R</td>
      <td>0.066377</td>
    </tr>
    <tr>
      <th>2</th>
      <td>BasalForebrain_L</td>
      <td>BasalForebrain_L</td>
      <td>0.003960</td>
    </tr>
    <tr>
      <th>3</th>
      <td>BasalForebrain_R</td>
      <td>BasalForebrain_R</td>
      <td>0.003753</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BasalGang_L</td>
      <td>CerebralNucli_L</td>
      <td>0.007522</td>
    </tr>
    <tr>
      <th>5</th>
      <td>BasalGang_R</td>
      <td>CerebralNucli_R</td>
      <td>0.007760</td>
    </tr>
    <tr>
      <th>6</th>
      <td>CentralSul_L</td>
      <td>Sulcus_L</td>
      <td>0.001562</td>
    </tr>
    <tr>
      <th>7</th>
      <td>CentralSul_R</td>
      <td>Sulcus_R</td>
      <td>0.001266</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Cerebellum_L</td>
      <td>Metencephalon_L</td>
      <td>0.052086</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Cerebellum_R</td>
      <td>Metencephalon_R</td>
      <td>0.051994</td>
    </tr>
    <tr>
      <th>10</th>
      <td>CinguSul_L</td>
      <td>Sulcus_L</td>
      <td>0.000849</td>
    </tr>
    <tr>
      <th>11</th>
      <td>CinguSul_R</td>
      <td>Sulcus_R</td>
      <td>0.001026</td>
    </tr>
    <tr>
      <th>12</th>
      <td>CorpusCallosum_L</td>
      <td>WhiteMatter_L</td>
      <td>0.008775</td>
    </tr>
    <tr>
      <th>13</th>
      <td>CorpusCallosum_R</td>
      <td>WhiteMatter_R</td>
      <td>0.009525</td>
    </tr>
    <tr>
      <th>14</th>
      <td>FrontSul_L</td>
      <td>Sulcus_L</td>
      <td>0.010853</td>
    </tr>
    <tr>
      <th>15</th>
      <td>FrontSul_R</td>
      <td>Sulcus_R</td>
      <td>0.008125</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Frontal_L</td>
      <td>CerebralCortex_L</td>
      <td>0.071375</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Frontal_R</td>
      <td>CerebralCortex_R</td>
      <td>0.071329</td>
    </tr>
    <tr>
      <th>18</th>
      <td>III_ventricle</td>
      <td>Ventricle</td>
      <td>0.001749</td>
    </tr>
    <tr>
      <th>19</th>
      <td>IV_ventricle</td>
      <td>Ventricle</td>
      <td>0.001953</td>
    </tr>
    <tr>
      <th>20</th>
      <td>InferiorWM_L</td>
      <td>WhiteMatter_L</td>
      <td>0.041868</td>
    </tr>
    <tr>
      <th>21</th>
      <td>InferiorWM_R</td>
      <td>WhiteMatter_R</td>
      <td>0.041452</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Insula_L</td>
      <td>CerebralCortex_L</td>
      <td>0.005238</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Insula_R</td>
      <td>CerebralCortex_R</td>
      <td>0.005123</td>
    </tr>
    <tr>
      <th>24</th>
      <td>LateralVentricle_L</td>
      <td>Ventricle</td>
      <td>0.015431</td>
    </tr>
    <tr>
      <th>25</th>
      <td>LateralVentricle_R</td>
      <td>Ventricle</td>
      <td>0.013993</td>
    </tr>
    <tr>
      <th>26</th>
      <td>LimbicWM_L</td>
      <td>WhiteMatter_L</td>
      <td>0.010363</td>
    </tr>
    <tr>
      <th>27</th>
      <td>LimbicWM_R</td>
      <td>WhiteMatter_R</td>
      <td>0.009914</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Limbic_L</td>
      <td>CerebralCortex_L</td>
      <td>0.020831</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Limbic_L</td>
      <td>CerebralNucli_L</td>
      <td>0.001434</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Limbic_R</td>
      <td>CerebralCortex_R</td>
      <td>0.023572</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Limbic_R</td>
      <td>CerebralNucli_R</td>
      <td>0.001699</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Medulla_L</td>
      <td>Myelencephalon_L</td>
      <td>0.001738</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Medulla_R</td>
      <td>Myelencephalon_R</td>
      <td>0.001861</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Occipital_L</td>
      <td>CerebralCortex_L</td>
      <td>0.026950</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Occipital_R</td>
      <td>CerebralCortex_R</td>
      <td>0.025343</td>
    </tr>
    <tr>
      <th>36</th>
      <td>OcciptSul_L</td>
      <td>Sulcus_L</td>
      <td>0.001399</td>
    </tr>
    <tr>
      <th>37</th>
      <td>OcciptSul_R</td>
      <td>Sulcus_R</td>
      <td>0.001486</td>
    </tr>
    <tr>
      <th>38</th>
      <td>ParietSul_L</td>
      <td>Sulcus_L</td>
      <td>0.006322</td>
    </tr>
    <tr>
      <th>39</th>
      <td>ParietSul_R</td>
      <td>Sulcus_R</td>
      <td>0.007037</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Parietal_L</td>
      <td>CerebralCortex_L</td>
      <td>0.030148</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Parietal_R</td>
      <td>CerebralCortex_R</td>
      <td>0.034546</td>
    </tr>
    <tr>
      <th>42</th>
      <td>Pons_L</td>
      <td>Metencephalon_L</td>
      <td>0.005420</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Pons_R</td>
      <td>Metencephalon_R</td>
      <td>0.005812</td>
    </tr>
    <tr>
      <th>44</th>
      <td>PosteriorWM_L</td>
      <td>WhiteMatter_L</td>
      <td>0.050951</td>
    </tr>
    <tr>
      <th>45</th>
      <td>PosteriorWM_R</td>
      <td>WhiteMatter_R</td>
      <td>0.051761</td>
    </tr>
    <tr>
      <th>46</th>
      <td>SylvianFissureExt_L</td>
      <td>Sulcus_L</td>
      <td>0.002768</td>
    </tr>
    <tr>
      <th>47</th>
      <td>SylvianFissureExt_R</td>
      <td>Sulcus_R</td>
      <td>0.002116</td>
    </tr>
    <tr>
      <th>48</th>
      <td>TempSul_L</td>
      <td>Sulcus_L</td>
      <td>0.000824</td>
    </tr>
    <tr>
      <th>49</th>
      <td>TempSul_R</td>
      <td>Sulcus_R</td>
      <td>0.000658</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Temporal_L</td>
      <td>CerebralCortex_L</td>
      <td>0.045819</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Temporal_R</td>
      <td>CerebralCortex_R</td>
      <td>0.044710</td>
    </tr>
    <tr>
      <th>52</th>
      <td>Thalamus_L</td>
      <td>Thalamus_L</td>
      <td>0.004588</td>
    </tr>
    <tr>
      <th>53</th>
      <td>Thalamus_R</td>
      <td>Thalamus_R</td>
      <td>0.004609</td>
    </tr>
    <tr>
      <th>54</th>
      <td>midbrain_L</td>
      <td>Mesencephalon_L</td>
      <td>0.003577</td>
    </tr>
    <tr>
      <th>55</th>
      <td>midbrain_R</td>
      <td>Mesencephalon_R</td>
      <td>0.003853</td>
    </tr>
  </tbody>
</table>
</div>




```python
rois = pd.concat([df['level0'], df['level1'],df['level2'],df['level3']]).unique().tolist()
rois
```




    ['ICV',
     'Telencephalon_L',
     'Telencephalon_R',
     'Diencephalon_L',
     'Diencephalon_R',
     'Mesencephalon',
     'Metencephalon',
     'Myelencephalon',
     'CSF',
     'CerebralCortex_L',
     'CerebralCortex_R',
     'CerebralNucli_L',
     'CerebralNucli_R',
     'Thalamus_L',
     'Thalamus_R',
     'BasalForebrain_L',
     'BasalForebrain_R',
     'Mesencephalon_L',
     'Mesencephalon_R',
     'Metencephalon_R',
     'Metencephalon_L',
     'Myelencephalon_L',
     'Myelencephalon_R',
     'WhiteMatter_L',
     'WhiteMatter_R',
     'Ventricle',
     'Sulcus_L',
     'Sulcus_R',
     'Frontal_L',
     'Frontal_R',
     'Parietal_L',
     'Parietal_R',
     'Temporal_L',
     'Temporal_R',
     'Limbic_L',
     'Limbic_R',
     'Occipital_L',
     'Occipital_R',
     'Insula_L',
     'Insula_R',
     'BasalGang_L',
     'BasalGang_R',
     'midbrain_L',
     'midbrain_R',
     'Cerebellum_R',
     'Cerebellum_L',
     'Pons_L',
     'Pons_R',
     'Medulla_L',
     'Medulla_R',
     'AnteriorWM_L',
     'AnteriorWM_R',
     'PosteriorWM_L',
     'PosteriorWM_R',
     'CorpusCallosum_L',
     'CorpusCallosum_R',
     'InferiorWM_L',
     'InferiorWM_R',
     'LimbicWM_L',
     'LimbicWM_R',
     'LateralVentricle_L',
     'LateralVentricle_R',
     'III_ventricle',
     'FrontSul_L',
     'FrontSul_R',
     'CentralSul_L',
     'CentralSul_R',
     'SylvianFissureExt_L',
     'SylvianFissureExt_R',
     'ParietSul_L',
     'ParietSul_R',
     'CinguSul_L',
     'CinguSul_R',
     'OcciptSul_L',
     'OcciptSul_R',
     'TempSul_L',
     'TempSul_R',
     'IV_ventricle']




```python
sankey_dat = pd.concat([l1,l2,l3])
sankey_dat['target_idx']=[rois.index(x)for x in sankey_dat['target']]
sankey_dat['source_idx']=[rois.index(x)for x in sankey_dat['source']]
sankey_dat
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>source</th>
      <th>comp</th>
      <th>target_idx</th>
      <th>source_idx</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CSF</td>
      <td>ICV</td>
      <td>0.079417</td>
      <td>8</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Diencephalon_L</td>
      <td>ICV</td>
      <td>0.008548</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Diencephalon_R</td>
      <td>ICV</td>
      <td>0.008362</td>
      <td>4</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Mesencephalon</td>
      <td>ICV</td>
      <td>0.007430</td>
      <td>5</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Metencephalon</td>
      <td>ICV</td>
      <td>0.115313</td>
      <td>6</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Temporal_R</td>
      <td>CerebralCortex_R</td>
      <td>0.044710</td>
      <td>33</td>
      <td>10</td>
    </tr>
    <tr>
      <th>52</th>
      <td>Thalamus_L</td>
      <td>Thalamus_L</td>
      <td>0.004588</td>
      <td>13</td>
      <td>13</td>
    </tr>
    <tr>
      <th>53</th>
      <td>Thalamus_R</td>
      <td>Thalamus_R</td>
      <td>0.004609</td>
      <td>14</td>
      <td>14</td>
    </tr>
    <tr>
      <th>54</th>
      <td>midbrain_L</td>
      <td>Mesencephalon_L</td>
      <td>0.003577</td>
      <td>42</td>
      <td>17</td>
    </tr>
    <tr>
      <th>55</th>
      <td>midbrain_R</td>
      <td>Mesencephalon_R</td>
      <td>0.003853</td>
      <td>43</td>
      <td>18</td>
    </tr>
  </tbody>
</table>
<p>83 rows × 5 columns</p>
</div>




```python
import plotly.graph_objects as go

fig = go.Figure(data=[go.Sankey(
    node = dict(
      pad = 15,
      thickness = 20,
      line = dict(color = "black", width = 0.5),
      label = rois,
      color = "blue"
    ),
    link = dict(
      source = sankey_dat['source_idx'],
      target = sankey_dat['target_idx'],
      value = sankey_dat['comp']
  ))])

fig.update_layout(title_text="Brain composition", height= 1000, font_size=10)
fig.show()
```


<div>                            <div id="fd0f2beb-bbb7-432f-88ab-aa2922419b11" class="plotly-graph-div" style="height:1000px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("fd0f2beb-bbb7-432f-88ab-aa2922419b11")) {                    Plotly.newPlot(                        "fd0f2beb-bbb7-432f-88ab-aa2922419b11",                        [{"link":{"source":[0,0,0,0,0,0,0,0,3,4,1,2,1,2,5,5,6,6,7,7,8,8,3,4,8,1,2,23,24,15,16,11,12,26,27,20,19,26,27,23,24,26,27,9,10,25,25,23,24,9,10,25,25,23,24,9,11,10,12,21,22,9,10,26,27,26,27,9,10,20,19,23,24,26,27,26,27,9,10,13,14,17,18],"target":[8,3,4,5,6,7,1,2,15,16,9,10,11,12,17,18,20,19,21,22,26,27,13,14,25,23,24,50,51,15,16,40,41,65,66,45,44,71,72,54,55,63,64,28,29,62,77,56,57,38,39,60,61,58,59,34,34,35,35,48,49,36,37,73,74,69,70,30,31,46,47,52,53,67,68,75,76,32,33,13,14,42,43],"value":[0.07941664532724545,0.008548065780393485,0.00836215963623159,0.007429735434579121,0.11531316866533857,0.003598766798464719,0.38422025754872985,0.39311120080901724,0.003960451903838058,0.0037528446533537617,0.20036052771303614,0.20462262499475556,0.00895604657925461,0.009459512245934297,0.0035770656921423187,0.0038526697424368025,0.057506485013939346,0.05780668365139922,0.0017382586164242653,0.0018605081820404538,0.02457650291011836,0.021714126986193755,0.004587613876555427,0.0046093149828778275,0.03312601543093334,0.17490368325643907,0.17902906356832737,0.06294695236896511,0.06637717390832584,0.003960451903838058,0.0037528446533537617,0.007521603451343949,0.007760315620890352,0.001561756285002076,0.001265897868806685,0.052086272024814494,0.051994404008049666,0.0008485132572058524,0.001026462329049535,0.00877520402656794,0.009524615564901499,0.010853446642043145,0.008124894207106678,0.07137493869437464,0.07132864300088686,0.0017491091695854655,0.0019530995690160283,0.041867944427806926,0.04145200655662759,0.00523792369601669,0.005122907832507968,0.015430933335648118,0.013992873356683724,0.010363001639156898,0.00991378873828321,0.020830891958872066,0.0014344431279106609,0.023571741687391224,0.0016991966250439448,0.0017382586164242653,0.0018605081820404538,0.026949880571578207,0.025343275333509836,0.0013989979875840737,0.001485802412873675,0.006321532271715212,0.007036945410143676,0.030147900273289265,0.034545991154629065,0.005420212989124852,0.005812279643349551,0.050950580793942206,0.051761478800189234,0.0027683377965275337,0.002115857866434031,0.0008239186700404654,0.0006582668917794762,0.04581899251890528,0.044710065985830626,0.004587613876555427,0.0046093149828778275,0.0035770656921423187,0.0038526697424368025]},"node":{"color":"blue","label":["ICV","Telencephalon_L","Telencephalon_R","Diencephalon_L","Diencephalon_R","Mesencephalon","Metencephalon","Myelencephalon","CSF","CerebralCortex_L","CerebralCortex_R","CerebralNucli_L","CerebralNucli_R","Thalamus_L","Thalamus_R","BasalForebrain_L","BasalForebrain_R","Mesencephalon_L","Mesencephalon_R","Metencephalon_R","Metencephalon_L","Myelencephalon_L","Myelencephalon_R","WhiteMatter_L","WhiteMatter_R","Ventricle","Sulcus_L","Sulcus_R","Frontal_L","Frontal_R","Parietal_L","Parietal_R","Temporal_L","Temporal_R","Limbic_L","Limbic_R","Occipital_L","Occipital_R","Insula_L","Insula_R","BasalGang_L","BasalGang_R","midbrain_L","midbrain_R","Cerebellum_R","Cerebellum_L","Pons_L","Pons_R","Medulla_L","Medulla_R","AnteriorWM_L","AnteriorWM_R","PosteriorWM_L","PosteriorWM_R","CorpusCallosum_L","CorpusCallosum_R","InferiorWM_L","InferiorWM_R","LimbicWM_L","LimbicWM_R","LateralVentricle_L","LateralVentricle_R","III_ventricle","FrontSul_L","FrontSul_R","CentralSul_L","CentralSul_R","SylvianFissureExt_L","SylvianFissureExt_R","ParietSul_L","ParietSul_R","CinguSul_L","CinguSul_R","OcciptSul_L","OcciptSul_R","TempSul_L","TempSul_R","IV_ventricle"],"line":{"color":"black","width":0.5},"pad":15,"thickness":20},"type":"sankey"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"title":{"text":"Brain composition"},"font":{"size":10},"height":1000},                        {"responsive": true}                    ).then(function(){

var gd = document.getElementById('fd0f2beb-bbb7-432f-88ab-aa2922419b11');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>



```python
import sqlite3 as sq3
import pandas as pd
```


```python
con = sq3.connect("ds/opioid.db")
sql = con.cursor()

```


```python
con = sq3.connect("ds/opioid.db")
annual = pd.read_sql_query("SELECT * from annual", con)
land= pd.read_sql_query("SELECT * from land", con)
population = pd.read_sql_query("SELECT * from population", con)
land
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Areaname</th>
      <th>STCOU</th>
      <th>LND010190F</th>
      <th>LND010190D</th>
      <th>LND010190N1</th>
      <th>LND010190N2</th>
      <th>LND010200F</th>
      <th>LND010200D</th>
      <th>LND010200N1</th>
      <th>...</th>
      <th>LND110210N1</th>
      <th>LND110210N2</th>
      <th>LND210190F</th>
      <th>LND210190D</th>
      <th>LND210190N1</th>
      <th>LND210190N2</th>
      <th>LND210200F</th>
      <th>LND210200D</th>
      <th>LND210200N1</th>
      <th>LND210200N2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>UNITED STATES</td>
      <td>00000</td>
      <td>0</td>
      <td>3787425.08</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>3794083.06</td>
      <td>0000</td>
      <td>...</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>251083.35</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>256644.62</td>
      <td>0000</td>
      <td>0000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>ALABAMA</td>
      <td>01000</td>
      <td>0</td>
      <td>52422.94</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>52419.02</td>
      <td>0000</td>
      <td>...</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>1672.71</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>1675.01</td>
      <td>0000</td>
      <td>0000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Autauga, AL</td>
      <td>01001</td>
      <td>0</td>
      <td>604.49</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>604.45</td>
      <td>0000</td>
      <td>...</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>8.48</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>8.48</td>
      <td>0000</td>
      <td>0000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Baldwin, AL</td>
      <td>01003</td>
      <td>0</td>
      <td>2027.08</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>2026.93</td>
      <td>0000</td>
      <td>...</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>430.55</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>430.58</td>
      <td>0000</td>
      <td>0000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Barbour, AL</td>
      <td>01005</td>
      <td>0</td>
      <td>904.59</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>904.52</td>
      <td>0000</td>
      <td>...</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>19.59</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>19.61</td>
      <td>0000</td>
      <td>0000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3193</th>
      <td>3194</td>
      <td>Sweetwater, WY</td>
      <td>56037</td>
      <td>0</td>
      <td>10491.73</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>10491.17</td>
      <td>0000</td>
      <td>...</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>65.86</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>65.87</td>
      <td>0000</td>
      <td>0000</td>
    </tr>
    <tr>
      <th>3194</th>
      <td>3195</td>
      <td>Teton, WY</td>
      <td>56039</td>
      <td>0</td>
      <td>4221.96</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>4221.8</td>
      <td>0000</td>
      <td>...</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>214.02</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>214.04</td>
      <td>0000</td>
      <td>0000</td>
    </tr>
    <tr>
      <th>3195</th>
      <td>3196</td>
      <td>Uinta, WY</td>
      <td>56041</td>
      <td>0</td>
      <td>2087.66</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>2087.56</td>
      <td>0000</td>
      <td>...</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>5.91</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>5.9</td>
      <td>0000</td>
      <td>0000</td>
    </tr>
    <tr>
      <th>3196</th>
      <td>3197</td>
      <td>Washakie, WY</td>
      <td>56043</td>
      <td>0</td>
      <td>2242.85</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>2242.75</td>
      <td>0000</td>
      <td>...</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>2.69</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>2.69</td>
      <td>0000</td>
      <td>0000</td>
    </tr>
    <tr>
      <th>3197</th>
      <td>3198</td>
      <td>Weston, WY</td>
      <td>56045</td>
      <td>0</td>
      <td>2400.13</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>2400.07</td>
      <td>0000</td>
      <td>...</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>2.21</td>
      <td>0000</td>
      <td>0000</td>
      <td>0</td>
      <td>2.21</td>
      <td>0000</td>
      <td>0000</td>
    </tr>
  </tbody>
</table>
<p>3198 rows × 35 columns</p>
</div>




```python
#select BUYER_COUNTY, BUYER_STATE, STATE, COUNTY, year, population from population limit 5
population[['BUYER_COUNTY', 'BUYER_STATE', 'STATE', 'COUNTY', 'year', 'population']].head(5)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BUYER_COUNTY</th>
      <th>BUYER_STATE</th>
      <th>STATE</th>
      <th>COUNTY</th>
      <th>year</th>
      <th>population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AUTAUGA</td>
      <td>AL</td>
      <td>1</td>
      <td>1</td>
      <td>2006</td>
      <td>51328</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BALDWIN</td>
      <td>AL</td>
      <td>1</td>
      <td>3</td>
      <td>2006</td>
      <td>168121</td>
    </tr>
    <tr>
      <th>2</th>
      <td>BARBOUR</td>
      <td>AL</td>
      <td>1</td>
      <td>5</td>
      <td>2006</td>
      <td>27861</td>
    </tr>
    <tr>
      <th>3</th>
      <td>BIBB</td>
      <td>AL</td>
      <td>1</td>
      <td>7</td>
      <td>2006</td>
      <td>22099</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BLOUNT</td>
      <td>AL</td>
      <td>1</td>
      <td>9</td>
      <td>2006</td>
      <td>55485</td>
    </tr>
  </tbody>
</table>
</div>




```python
#select * from annual where countyfips = "NA" limit 10
annual.loc[annual['countyfips'] == 'NA'].head(10)

```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>BUYER_COUNTY</th>
      <th>BUYER_STATE</th>
      <th>year</th>
      <th>count</th>
      <th>DOSAGE_UNIT</th>
      <th>countyfips</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>187</th>
      <td>188</td>
      <td>ADJUNTAS</td>
      <td>PR</td>
      <td>2006</td>
      <td>147</td>
      <td>102800</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>188</th>
      <td>189</td>
      <td>ADJUNTAS</td>
      <td>PR</td>
      <td>2007</td>
      <td>153</td>
      <td>104800</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>189</th>
      <td>190</td>
      <td>ADJUNTAS</td>
      <td>PR</td>
      <td>2008</td>
      <td>153</td>
      <td>45400</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>190</th>
      <td>191</td>
      <td>ADJUNTAS</td>
      <td>PR</td>
      <td>2009</td>
      <td>184</td>
      <td>54200</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>191</th>
      <td>192</td>
      <td>ADJUNTAS</td>
      <td>PR</td>
      <td>2010</td>
      <td>190</td>
      <td>56200</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>192</th>
      <td>193</td>
      <td>ADJUNTAS</td>
      <td>PR</td>
      <td>2011</td>
      <td>186</td>
      <td>65530</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>193</th>
      <td>194</td>
      <td>ADJUNTAS</td>
      <td>PR</td>
      <td>2012</td>
      <td>138</td>
      <td>57330</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>194</th>
      <td>195</td>
      <td>ADJUNTAS</td>
      <td>PR</td>
      <td>2013</td>
      <td>138</td>
      <td>65820</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>195</th>
      <td>196</td>
      <td>ADJUNTAS</td>
      <td>PR</td>
      <td>2014</td>
      <td>90</td>
      <td>59490</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>196</th>
      <td>197</td>
      <td>AGUADA</td>
      <td>PR</td>
      <td>2006</td>
      <td>160</td>
      <td>49200</td>
      <td>NA</td>
    </tr>
  </tbody>
</table>
</div>




```python
#select * from annual where countyfips = "NA" and BUYER_STATE != "PR" limit 10
annual.loc[(annual['countyfips'] == 'NA') & (annual['BUYER_STATE'] !='PR')].head(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>BUYER_COUNTY</th>
      <th>BUYER_STATE</th>
      <th>year</th>
      <th>count</th>
      <th>DOSAGE_UNIT</th>
      <th>countyfips</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10071</th>
      <td>10072</td>
      <td>GUAM</td>
      <td>GU</td>
      <td>2006</td>
      <td>319</td>
      <td>265348</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>10072</th>
      <td>10073</td>
      <td>GUAM</td>
      <td>GU</td>
      <td>2007</td>
      <td>330</td>
      <td>275600</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>10073</th>
      <td>10074</td>
      <td>GUAM</td>
      <td>GU</td>
      <td>2008</td>
      <td>313</td>
      <td>286900</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>10074</th>
      <td>10075</td>
      <td>GUAM</td>
      <td>GU</td>
      <td>2009</td>
      <td>390</td>
      <td>355300</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>10075</th>
      <td>10076</td>
      <td>GUAM</td>
      <td>GU</td>
      <td>2010</td>
      <td>510</td>
      <td>413800</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>10076</th>
      <td>10077</td>
      <td>GUAM</td>
      <td>GU</td>
      <td>2011</td>
      <td>559</td>
      <td>475600</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>10077</th>
      <td>10078</td>
      <td>GUAM</td>
      <td>GU</td>
      <td>2012</td>
      <td>616</td>
      <td>564800</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>10078</th>
      <td>10079</td>
      <td>GUAM</td>
      <td>GU</td>
      <td>2013</td>
      <td>728</td>
      <td>623200</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>10079</th>
      <td>10080</td>
      <td>GUAM</td>
      <td>GU</td>
      <td>2014</td>
      <td>712</td>
      <td>558960</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>17429</th>
      <td>17430</td>
      <td>MONTGOMERY</td>
      <td>AR</td>
      <td>2006</td>
      <td>469</td>
      <td>175390</td>
      <td>NA</td>
    </tr>
  </tbody>
</table>
</div>




```python
#update annual set countyfips = 05097 where BUYER_STATE = "AR" and BUYER_COUNTY = "MONTGOMERY"
#select * from annual where BUYER_STATE = "AR" and BUYER_COUNTY = "MONTGOMERY"
annual.countyfips[(annual["BUYER_STATE"] == 'AR') & (annual['BUYER_COUNTY'] == 'MONTGOMERY')] = '05097'
annual.loc[(annual["BUYER_STATE"] == 'AR') & (annual['BUYER_COUNTY'] == 'MONTGOMERY')].head(5)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>BUYER_COUNTY</th>
      <th>BUYER_STATE</th>
      <th>year</th>
      <th>count</th>
      <th>DOSAGE_UNIT</th>
      <th>countyfips</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17429</th>
      <td>17430</td>
      <td>MONTGOMERY</td>
      <td>AR</td>
      <td>2006</td>
      <td>469</td>
      <td>175390</td>
      <td>05097</td>
    </tr>
    <tr>
      <th>17430</th>
      <td>17431</td>
      <td>MONTGOMERY</td>
      <td>AR</td>
      <td>2007</td>
      <td>597</td>
      <td>241270</td>
      <td>05097</td>
    </tr>
    <tr>
      <th>17431</th>
      <td>17432</td>
      <td>MONTGOMERY</td>
      <td>AR</td>
      <td>2008</td>
      <td>561</td>
      <td>251760</td>
      <td>05097</td>
    </tr>
    <tr>
      <th>17432</th>
      <td>17433</td>
      <td>MONTGOMERY</td>
      <td>AR</td>
      <td>2009</td>
      <td>554</td>
      <td>244160</td>
      <td>05097</td>
    </tr>
    <tr>
      <th>17433</th>
      <td>17434</td>
      <td>MONTGOMERY</td>
      <td>AR</td>
      <td>2010</td>
      <td>449</td>
      <td>247990</td>
      <td>05097</td>
    </tr>
  </tbody>
</table>
</div>




```python
#delete from annual where BUYER_COUNTY = "NA"
annual.drop(annual[annual['BUYER_COUNTY']== 'NA'].index)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>BUYER_COUNTY</th>
      <th>BUYER_STATE</th>
      <th>year</th>
      <th>count</th>
      <th>DOSAGE_UNIT</th>
      <th>countyfips</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>ABBEVILLE</td>
      <td>SC</td>
      <td>2006</td>
      <td>877</td>
      <td>363620</td>
      <td>45001</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>ABBEVILLE</td>
      <td>SC</td>
      <td>2007</td>
      <td>908</td>
      <td>402940</td>
      <td>45001</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ABBEVILLE</td>
      <td>SC</td>
      <td>2008</td>
      <td>871</td>
      <td>424590</td>
      <td>45001</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>ABBEVILLE</td>
      <td>SC</td>
      <td>2009</td>
      <td>930</td>
      <td>467230</td>
      <td>45001</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>ABBEVILLE</td>
      <td>SC</td>
      <td>2010</td>
      <td>1197</td>
      <td>539280</td>
      <td>45001</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>27736</th>
      <td>27737</td>
      <td>ZAVALA</td>
      <td>TX</td>
      <td>2010</td>
      <td>248</td>
      <td>200100</td>
      <td>48507</td>
    </tr>
    <tr>
      <th>27737</th>
      <td>27738</td>
      <td>ZAVALA</td>
      <td>TX</td>
      <td>2011</td>
      <td>406</td>
      <td>244800</td>
      <td>48507</td>
    </tr>
    <tr>
      <th>27738</th>
      <td>27739</td>
      <td>ZAVALA</td>
      <td>TX</td>
      <td>2012</td>
      <td>473</td>
      <td>263700</td>
      <td>48507</td>
    </tr>
    <tr>
      <th>27739</th>
      <td>27740</td>
      <td>ZAVALA</td>
      <td>TX</td>
      <td>2013</td>
      <td>399</td>
      <td>186700</td>
      <td>48507</td>
    </tr>
    <tr>
      <th>27740</th>
      <td>27741</td>
      <td>ZAVALA</td>
      <td>TX</td>
      <td>2014</td>
      <td>162</td>
      <td>148930</td>
      <td>48507</td>
    </tr>
  </tbody>
</table>
<p>27741 rows × 7 columns</p>
</div>




```python
annual_new = annual[['year','DOSAGE_UNIT']]
annual_new = annual.groupby(['year']).mean()
annual_new = annual_new.reset_index()
```


```python
land.columns
```




    Index(['', 'Areaname', 'STCOU', 'LND010190F', 'LND010190D', 'LND010190N1',
           'LND010190N2', 'LND010200F', 'LND010200D', 'LND010200N1', 'LND010200N2',
           'LND110180F', 'LND110180D', 'LND110180N1', 'LND110180N2', 'LND110190F',
           'LND110190D', 'LND110190N1', 'LND110190N2', 'LND110200F', 'LND110200D',
           'LND110200N1', 'LND110200N2', 'LND110210F', 'LND110210D', 'LND110210N1',
           'LND110210N2', 'LND210190F', 'LND210190D', 'LND210190N1', 'LND210190N2',
           'LND210200F', 'LND210200D', 'LND210200N1', 'LND210200N2'],
          dtype='object')




```python
#create table land_area as select Areaname, STCOU, LND110210D from land
land_area = land[['Areaname', 'STCOU','LND110210D']]
```


```python
#alter table land_area rename column STCOU to countyfips;
land_area = land_area.rename(columns = {'STCOU':'countyfips'})
land_area.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Areaname</th>
      <th>countyfips</th>
      <th>LND110210D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>UNITED STATES</td>
      <td>00000</td>
      <td>3531905.43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ALABAMA</td>
      <td>01000</td>
      <td>50645.33</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Autauga, AL</td>
      <td>01001</td>
      <td>594.44</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Baldwin, AL</td>
      <td>01003</td>
      <td>1589.78</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Barbour, AL</td>
      <td>01005</td>
      <td>884.88</td>
    </tr>
  </tbody>
</table>
</div>




```python
#create table county_info as select * from population left join land_area using(countyfips);
county_info = pd.merge(population,land_area,how='left', on='countyfips')
```


```python
#select count(*) from land
#select count(*) from land_area;
#select count(*) from county_info;
#select count(*) from population;
#np.shape(land)[0],np.shape(land_area)[0],np.shape(county_info)[0],np.shape(population)[0]
print(len(land.index))
print(len(land_area.index))
print(len(county_info.index))
print(len(population.index))
```

    3198
    3198
    28265
    28265

Question 4

```python
! pip3 install plotly
import pandas as pd
import plotly.express as px
import numpy as np
```

    Defaulting to user installation because normal site-packages is not writeable
    Requirement already satisfied: plotly in /opt/tljh/user/lib/python3.9/site-packages (5.6.0)
    Requirement already satisfied: six in /opt/tljh/user/lib/python3.9/site-packages (from plotly) (1.16.0)
    Requirement already satisfied: tenacity>=6.2.0 in /opt/tljh/user/lib/python3.9/site-packages (from plotly) (8.0.1)



```python
annual.loc[:,'DOSAGE_UNIT']= annual.loc[:,'DOSAGE_UNIT'].astype(float)
```


```python
annual
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>BUYER_COUNTY</th>
      <th>BUYER_STATE</th>
      <th>year</th>
      <th>count</th>
      <th>DOSAGE_UNIT</th>
      <th>countyfips</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>ABBEVILLE</td>
      <td>SC</td>
      <td>2006</td>
      <td>877</td>
      <td>363620.0</td>
      <td>45001</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>ABBEVILLE</td>
      <td>SC</td>
      <td>2007</td>
      <td>908</td>
      <td>402940.0</td>
      <td>45001</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ABBEVILLE</td>
      <td>SC</td>
      <td>2008</td>
      <td>871</td>
      <td>424590.0</td>
      <td>45001</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>ABBEVILLE</td>
      <td>SC</td>
      <td>2009</td>
      <td>930</td>
      <td>467230.0</td>
      <td>45001</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>ABBEVILLE</td>
      <td>SC</td>
      <td>2010</td>
      <td>1197</td>
      <td>539280.0</td>
      <td>45001</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>27753</th>
      <td>27754</td>
      <td>NA</td>
      <td>NV</td>
      <td>2007</td>
      <td>447</td>
      <td>200600.0</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>27754</th>
      <td>27755</td>
      <td>NA</td>
      <td>NV</td>
      <td>2008</td>
      <td>5</td>
      <td>2200.0</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>27755</th>
      <td>27756</td>
      <td>NA</td>
      <td>OH</td>
      <td>2006</td>
      <td>23</td>
      <td>5100.0</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>27756</th>
      <td>27757</td>
      <td>NA</td>
      <td>PR</td>
      <td>2006</td>
      <td>10</td>
      <td>17800.0</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>27757</th>
      <td>27758</td>
      <td>NA</td>
      <td>PR</td>
      <td>2007</td>
      <td>2</td>
      <td>1300.0</td>
      <td>NA</td>
    </tr>
  </tbody>
</table>
<p>27758 rows × 7 columns</p>
</div>




```python
fig2= px.line(annual_new, x='year',y= 'DOSAGE_UNIT')
fig2.show()
```


<div>                            <div id="12fa4a02-7f43-4fb3-ba99-ef869262f2bd" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("12fa4a02-7f43-4fb3-ba99-ef869262f2bd")) {                    Plotly.newPlot(                        "12fa4a02-7f43-4fb3-ba99-ef869262f2bd",                        [{"hovertemplate":"year=%{x}<br>DOSAGE_UNIT=%{y}<extra></extra>","legendgroup":"","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"","orientation":"v","showlegend":false,"x":["2006","2007","2008","2009","2010","2011","2012","2013","2014"],"xaxis":"x","y":[2645409.707290645,2992099.4515711046,3252161.7270061728,3526038.029839096,3783655.7365586343,4035582.96672916,3993063.8952396372,3861751.7808752027,3768738.039222042],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"year"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"DOSAGE_UNIT"}},"legend":{"tracegroupgap":0},"margin":{"t":60}},                        {"responsive": true}                    ).then(function(){

var gd = document.getElementById('12fa4a02-7f43-4fb3-ba99-ef869262f2bd');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>





```python

```
